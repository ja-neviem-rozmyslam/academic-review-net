<div class="card-base p-6 h-full">
  <ng-container *ngIf="conferenceId !== null; else loading">
    <ng-container *ngIf="showInReadMode; then submissionReadComponent else submissionFormComponent"></ng-container>
  </ng-container>

  <ng-template #loading>
    <div class="skeleton-loader">
      <div class="arn-input">
        <div class="skeleton skeleton-text"></div>
      </div>
      <div class="arn-input">
        <div class="skeleton skeleton-text"></div>
      </div>
      <div class="arn-input">
        <div class="skeleton skeleton-text"></div>
      </div>
      <div class="flex flex-col gap-4 sm:flex-row sm:gap-8 w-full">
        <div class="arn-input sm:w-1/2">
          <div class="skeleton skeleton-text"></div>
        </div>
        <div class="arn-input sm:w-1/2">
          <div class="skeleton skeleton-text"></div>
        </div>
      </div>
      <div class="flex-grow w-full h-36">
        <div class="skeleton skeleton-text"></div>
      </div>
    </div>
  </ng-template>
</div>

<ng-template #submissionReadComponent>
  <div class="space-y-6">
    <div class="arn-input">
      <label for="nadpis-zaverecnej-prace-r">Nadpis záverečnej práce</label>
      <p id="nadpis-zaverecnej-prace-r">{{ submission?.title || 'Nedostupné' }}</p>
    </div>

    <div class="arn-input">
      <label for="typ-zaverecnej-prace-r">Typ záverečnej práce</label>
      <p id="typ-zaverecnej-prace-r">{{ getCategoryNameById(submission?.category) }}</p>
    </div>

    <div class="arn-input">
      <label for="spolu-autori-r">Spoluautori</label>
      <p id="spolu-autori-r">{{ submission?.coauthors?.join(', ') || 'Žiadni spoluautori' }}</p>
    </div>

    <div class="flex flex-col gap-4 sm:flex-row sm:gap-8 w-full">
      <div class="arn-input sm:w-1/2">
        <label for="abstrakt-anglicky-r">Abstrakt (Anglický)</label>
        <p id="abstrakt-anglicky-r">{{ submission?.abstractEn || 'Nedostupné' }}</p>
      </div>

      <div class="arn-input sm:w-1/2">
        <label for="abstrakt-slovensky-r">Abstrakt (Slovenský)</label>
        <p id="abstrakt-slovensky-r">{{ submission?.abstractSk || 'Nedostupné' }}</p>
      </div>
    </div>

    <div class="flex flex-col gap-4 w-full">
      <div class="flex-grow w-full h-36">
        <p>Súbory:</p>
        <div *ngIf="submission?.uploadedFiles?.length; else noFiles">
          <div *ngFor="let file of submission?.uploadedFiles">
            <div class="flex items-center gap-2">
              <button class="arn-button flex items-center gap-2" (click)="downloadFile(file)">
                <document-arrow-down-outline-icon></document-arrow-down-outline-icon>
                <span>{{ shortenFileName(file.name) }}</span>
              </button>
            </div>
          </div>
        </div>
        <ng-template #noFiles>
          <p>Žiadne súbory nahraté.</p>
        </ng-template>
      </div>
    </div>
    <div class="flex w-full mt-4" *ngIf="allowEditation">
      <app-arn-button [buttonText]="'Upraviť Prácu'" [classes]="'h-full'" (buttonClick)="openEditForm()"></app-arn-button>
    </div>
  </div>
</ng-template>

<ng-template #submissionFormComponent>
  <form class="space-y-4" (ngSubmit)="onSubmit()" appFormValidation>
    <div class="arn-input">
      <label for="nadpis-zaverecnej-prace">Nadpis záverečnej práce</label>
      <input
        type="text"
        id="nadpis-zaverecnej-prace"
        name="title"
        placeholder="Vložte nadpis"
        [(ngModel)]="submissionForm.title" required />
    </div>

    <div class="arn-input">
      <label for="typ-zaverecnej-prace">Typ záverečnej práce</label>
      <app-arn-select
        id="typ-zaverecnej-prace"
        name="typ-zaverecnej-prace"
        [(selectedOption)]="submissionForm.category"
        [options]="thesisCategories"
        [placeholder]="'Vyberte typ záverečnej práce'"
        [required]="true"></app-arn-select>
    </div>

    <div class="arn-input">
      <label for="spolu-autori">Spoluautori (Dobrovoľné)</label>
      <app-arn-select
        id="spolu-autori"
        [placeholder]="'Vyberte spolu autorov'"></app-arn-select>
    </div>

    <div class="flex flex-col gap-4 sm:flex-row sm:gap-8 w-full">
      <div class="arn-input sm:w-1/2">
        <label for="abstrakt-anglicky">Abstrakt (Anglický)</label>
        <textarea
          id="abstrakt-anglicky"
          rows="9"
          name="abstractEn"
          [(ngModel)]="submissionForm.abstractEn"
          placeholder="Vyplňte abstrakt v Anglickom jazyku" required></textarea>
      </div>

      <div class="arn-input sm:w-1/2">
        <label for="abstrakt-slovensky">Abstrakt (Slovenský)</label>
        <textarea
          id="abstrakt-slovensky"
          rows="9"
          name="abstractSk"
          [(ngModel)]="submissionForm.abstractSk"
          placeholder="Vyplňte abstrakt v Slovenskom jazyku" required></textarea>
      </div>
    </div>

    <div class="flex flex-col gap-4 w-full">
      <div class="flex-grow w-full h-36">
        <app-arn-fileinput
          [(fileSelected)]="uploadedFiles"
          [invalid]="invalidFileAmount"
          [acceptedFormats]="'.doc,.docx,.pdf'"
          [placeholder]="'Nahrajte prácu 2-krát (Jednu v PDF a druhú v DOCX formáte)'"
          [multiple]="true"
          [required]="true"
          [fileLimit]="2"></app-arn-fileinput>
      </div>
    </div>

    <div class="flex w-full mt-4">
      <app-arn-button type="submit" [buttonText]="'Odovzdať Prácu'" [classes]="'h-full'"></app-arn-button>
    </div>
  </form>
</ng-template>
